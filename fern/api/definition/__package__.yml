# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports: 
  commons: commons.yml

service:
  auth: true
  base-path: ""
  url: Predict
  endpoints:
    generate:
      path: /v1/generate
      method: POST
      request: 
        name: BatchGenerateRequest
        body: 
          properties: 
            deployment_id: optional<uuid>
            deployment_name: optional<string>
            requests: list<GenerateRequest>
            options: optional<GenerateOptionsRequest>
      response: GenerateResponse
      errors: 
        - commons.BadRequestError
        - commons.NotFoundError
        - commons.InternalServerError
  
    search:
      path: /v1/search
      method: POST
      request: 
        name: SearchRequest
        body: 
          properties:
            index_id: optional<uuid>
            index_name: optional<string>
            query: string
            options: SearchRequestOptions
      response: SearchResponse
      errors: 
        - commons.BadRequestError
        - commons.NotFoundError
        - commons.InternalServerError

types:
  SearchResponse:
    properties:
      results: list<SearchResult>

  SearchRequestOptions:
    properties:
      limit: optional<integer>
      weights: optional<SearchWeightsRequest>

  SearchWeightsRequest:
    properties:
      semantic_similarity: double
      keywords: double

  SearchResult:
    properties:
      document: Document
      text: string
      keywords: list<string>
      score: double

  Document:
    properties:
      id: uuid
      label:
        docs: >-
          A human-readable label for the document. Defaults to the originally
          uploaded file's file name.
        type: string
      external_id:
        docs: >-
          The unique id of this document as it exists in the user's system. If
          not provided, will be set to the document's id.
        type: optional<string>

  GenerateResponse:
    properties:
      results: list<GenerateResult>

  GenerateRequest:
    properties:
      input_values: map<string, unknown>
      external_ids: optional<list<string>>

  GenerateOptionsRequest:
    properties:
      logprobs: optional<LogprobsEnum>

  LogprobsEnum:
    enum:
      - ALL
      - NONE

  GenerateResult:
    properties:
      data: optional<GenerateResultData>
      error: optional<GenerateResultError>

  GenerateResultData:
    properties:
      completions: list<EnrichedNormalizedCompletion>

  EnrichedNormalizedCompletion:
    properties:
      id: uuid
      external_id: optional<string>
      text: string
      finish_reason: FinishReasonEnum
      logprobs: optional<NormalizedLogProbs>
      model_version_id: string

  FinishReasonEnum:
    enum:
      - LENGTH
      - STOP
      - UNKNOWN

  NormalizedLogProbs:
    properties:
      tokens: list<NormalizedTokenLogProbs>
      likelihood: double

  NormalizedTokenLogProbs:
    properties:
      token: string
      logprob: optional<double>
      top_logprobs: optional<map<string, double>>
      text_offset: integer

  GenerateResultError:
    properties:
      message: string
